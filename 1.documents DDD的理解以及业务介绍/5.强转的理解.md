# å¼ºè½¬

D:\Code\1.microservice\6.netcore_microservice_DDD_ProjectService\ä»£ç ç¤ºä¾‹\Domain\Orders\Address.cs

```
public override bool Equals(object obj)
        {
            if (obj == null || obj.GetType() != GetType())
            {
                return false;
            }

            var other = (ValueObject)obj;
            return GetEqualityComponents().SequenceEqual(other.GetEqualityComponents());
        }
```

æˆ‘å¯¹è¿™ä¸ªå¼ºè½¬å“ˆï¼Œ(ValueObject)obj; æ€ä¹ˆä¹Ÿéƒ½ç†è§£ä¸ä¸Šå» obj è¢«å¼ºåˆ¶è½¬æˆ ValueObject äº†ï¼Œé‚£è¿˜æ˜¯ Address å—ï¼Œç„¶åèƒ½è°ƒç”¨åˆ° address é‡Œçš„é¢ GetEqualityComponents æ–¹æ³•ï¼Ÿ

# è§£æƒ‘

éå¸¸å¥½çš„é—®é¢˜ï¼ è¿™æ¶‰åŠåˆ° C#çš„å¤šæ€å’Œè¿è¡Œæ—¶ç±»å‹æ¦‚å¿µã€‚è®©æˆ‘è¯¦ç»†è§£é‡Šè¿™ä¸ª"é­”æ³•"æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

ğŸ¯ æ ¸å¿ƒæ¦‚å¿µï¼šå¤šæ€ï¼ˆPolymorphismï¼‰
åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œå­ç±»å¯¹è±¡å¯ä»¥è¢«å½“ä½œçˆ¶ç±»ç±»å‹ä½¿ç”¨ï¼Œä½†è°ƒç”¨æ–¹æ³•æ—¶ä»ç„¶æ‰§è¡Œå­ç±»çš„å®ç°ã€‚

ğŸ” è¯¦ç»†åˆ†æè¿™ä¸ªè½¬æ¢è¿‡ç¨‹
ä»£ç å›é¡¾

```
public override bool Equals(object obj)
{
    if (obj == null || obj.GetType() != GetType())
    {
        return false;
    }

    var other = (ValueObject)obj;  // è¿™é‡Œï¼
    return GetEqualityComponents().SequenceEqual(other.GetEqualityComponents());
}
```

å®é™…æ‰§è¡Œè¿‡ç¨‹ï¼š

```
var address1 = new Address("åŒ—äº¬", "åŒ—äº¬", "æµ·æ·€åŒº", "ä¸­å…³æ‘å¤§è¡—1å·", "100080");
var address2 = new Address("åŒ—äº¬", "åŒ—äº¬", "æµ·æ·€åŒº", "ä¸­å…³æ‘å¤§è¡—1å·", "100080");

// è°ƒç”¨ address1.Equals(address2)
```

æ­¥éª¤ 1ï¼šç±»å‹æ£€æŸ¥é€šè¿‡

```
// objæ˜¯address2ï¼Œç±»å‹æ˜¯Address
// GetType()è¿”å›å½“å‰å¯¹è±¡ï¼ˆaddress1ï¼‰çš„ç±»å‹ï¼Œä¹Ÿæ˜¯Address
// æ‰€ä»¥æ¡ä»¶é€šè¿‡ï¼šobj.GetType() == GetType() â†’ Address == Address
```

æ­¥éª¤ 2ï¼šå¼ºåˆ¶è½¬æ¢

```
var other = (ValueObject)address2;  // å°†Addressè½¬æ¢ä¸ºValueObject
```

å…³é”®ç‚¹ï¼šè™½ç„¶ other å˜é‡çš„ç¼–è¯‘æ—¶ç±»å‹æ˜¯ ValueObjectï¼Œä½†å®ƒå®é™…æŒ‡å‘çš„å¯¹è±¡ä»ç„¶æ˜¯ Address å®ä¾‹ï¼
ğŸ—ï¸ å†…å­˜æ¨¡å‹è§£é‡Š

```
å †å†…å­˜ï¼š
[Addresså¯¹è±¡] â† åŒ…å«Addressæ•°æ®å’ŒValueObjectæ•°æ®
  â”‚
  â”œâ”€â”€ ValueObjectéƒ¨åˆ†ï¼ˆåŸºç±»ï¼‰
  â””â”€â”€ Addresséƒ¨åˆ†ï¼ˆå­ç±»ï¼‰- åŒ…å«GetEqualityComponentså®ç°

æ ˆå†…å­˜ï¼š
otherå˜é‡ â†’ ValueObjectç±»å‹ï¼ˆç¼–è¯‘æ—¶ï¼‰
            â†“
            å®é™…æŒ‡å‘Addresså¯¹è±¡ï¼ˆè¿è¡Œæ—¶ï¼‰
```

ç±»æ¯”ç†è§£ï¼š
æƒ³è±¡ä¸€ä¸ªç»ç†ï¼ˆValueObjectï¼‰å’ŒæŠ€æœ¯ä¸“å®¶ï¼ˆAddressï¼‰ï¼š

ä½ å¯ä»¥æŠŠæŠ€æœ¯ä¸“å®¶"å½“ä½œ"ç»ç†æ¥å¯¹å¾…ï¼ˆå‘ä¸Šè½¬å‹ï¼‰

ä½†å½“ä½ é—®ä»–æŠ€æœ¯é—®é¢˜æ—¶ï¼Œä»–ä»ç„¶ä»¥æŠ€æœ¯ä¸“å®¶çš„èº«ä»½å›ç­”ï¼ˆå¤šæ€ï¼‰

# ğŸ§ª éªŒè¯å¤šæ€è¡Œä¸º

```
public class TestValueObject : ValueObject
{
    public string TestProperty { get; }

    public TestValueObject(string value)
    {
        TestProperty = value;
    }

    protected override IEnumerable<object> GetEqualityComponents()
    {
        Console.WriteLine($"GetEqualityComponents called in TestValueObject: {TestProperty}");
        yield return TestProperty;
    }
}

// æµ‹è¯•ä»£ç 
var obj1 = new TestValueObject("Hello");
var obj2 = new TestValueObject("Hello");

// è™½ç„¶è½¬æ¢ä¸ºValueObjectï¼Œä½†ä»ç„¶è°ƒç”¨å­ç±»çš„æ–¹æ³•
ValueObject baseObj1 = (ValueObject)obj1;  // å‘ä¸Šè½¬å‹
ValueObject baseObj2 = (ValueObject)obj2;

Console.WriteLine("è°ƒç”¨ baseObj1.Equals(baseObj2):");
bool result = baseObj1.Equals(baseObj2);
```

è¾“å‡ºç»“æœï¼š

```
è°ƒç”¨ baseObj1.Equals(baseObj2):
GetEqualityComponents called in TestValueObject: Hello
GetEqualityComponents called in TestValueObject: Hello
True
```

ğŸ”„ åœ¨ Address åœºæ™¯ä¸­çš„å…·ä½“åº”ç”¨

```
var address1 = new Address("åŒ—äº¬", "åŒ—äº¬", "æµ·æ·€åŒº", "ä¸­å…³æ‘å¤§è¡—1å·", "100080");
var address2 = new Address("åŒ—äº¬", "åŒ—äº¬", "æµ·æ·€åŒº", "ä¸­å…³æ‘å¤§è¡—1å·", "100080");

// è°ƒç”¨é“¾ï¼š
address1.Equals(address2)
    â†“
ValueObject.Equals(address2)  // address2ä½œä¸ºobjectä¼ å…¥
    â†“
// åœ¨ValueObject.Equalsä¸­ï¼š
var other = (ValueObject)address2;  // å‘ä¸Šè½¬å‹ä¸ºValueObject
    â†“
other.GetEqualityComponents()  // å¤šæ€ï¼šå®é™…è°ƒç”¨Address.GetEqualityComponents()
    â†“
Address.GetEqualityComponents()  // æ‰§è¡Œå­ç±»å®ç°
```

âœ… æ€»ç»“
å›ç­”ä½ çš„é—®é¢˜ï¼š

"obj è¢«å¼ºåˆ¶è½¬æˆ ValueObject äº†ï¼Œé‚£è¿˜æ˜¯ Address å—ï¼Œç„¶åèƒ½è°ƒç”¨åˆ° address é‡Œçš„ GetEqualityComponents æ–¹æ³•ï¼Ÿ"

ç­”æ¡ˆæ˜¯ï¼šæ˜¯çš„ï¼Œå®Œå…¨æ­£ç¡®ï¼

âœ… æ€»ç»“
åœ¨ ValueObject ä¸­ä½¿ç”¨å¼ºåˆ¶è½¬æ¢çš„åŸå› ï¼š

å®‰å…¨æ€§ï¼šæˆ‘ä»¬å·²ç»é€šè¿‡ obj.GetType() != GetType() ç¡®ä¿äº†ç±»å‹åŒ¹é…

æ€§èƒ½ï¼šå¼ºåˆ¶è½¬æ¢æ¯” as è½¬æ¢ç¨å¿«

# ğŸ¯ å¤šæ€è°ƒç”¨çš„ç²¾ç¡®è§„åˆ™

è§„åˆ™æ€»ç»“ï¼š
æ–¹æ³•ç±»å‹ åŸºç±»å¼•ç”¨è°ƒç”¨ç»“æœ
abstract æ–¹æ³• å¿…é¡»è°ƒç”¨å­ç±»å®ç°
virtual æ–¹æ³• + override è°ƒç”¨å­ç±»é‡å†™ç‰ˆæœ¬
virtual æ–¹æ³•ï¼ˆæ—  overrideï¼‰ è°ƒç”¨åŸºç±»ç‰ˆæœ¬
å­ç±»ç‹¬æœ‰æ–¹æ³• æ— æ³•é€šè¿‡åŸºç±»å¼•ç”¨è°ƒç”¨
