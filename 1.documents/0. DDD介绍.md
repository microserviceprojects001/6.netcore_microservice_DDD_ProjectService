# DDD

- 什么是 DDD? 从三层到 OOP, OOD 开始认识
- 结合业务需求来认识各种名称

```
  界限上下文
  实体
  值对象
  聚合
  聚合根
  仓储-持久化
```

- 领域分层
- CQRS (Command Query Responsibility Segregation) 命令查询职责分离
- 业务介绍 - 领域事件与集成事件
- 项目 - 实现

# DDD

## DDD : Domain Driven Design 领域驱动设计

```
  界限上下文
  实体
  值对象
  聚合
  聚合根
  仓储
  领域事件
  CQRS (Command Query Responsibility Segregation) 命令查询职责分离
```

集成事件

# 缩写和含义

1. DAL - 数据访问层

- 全称：Data Access Layer

- 职责：专门负责与数据库（或其他数据源）进行交互。它封装了所有数据持久化的细节。
- 主要工作：

```
执行CRUD操作（Create, Read, Update, Delete）。

连接数据库，执行SQL语句或调用存储过程。

使用ORM（如Entity Framework, Dapper, Hibernate）框架来映射对象和数据库表。


```

- 简单来说：DAL 只关心“如何把数据存进去，如何取出来”，不关心这些数据用来做什么业务逻辑。

2. BLL - 业务逻辑层

- 全称：Business Logic Layer

- 职责：包含应用程序的核心业务规则和逻辑。它是应用程序的“大脑”。

- 主要工作：

```
处理复杂的业务规则验证（例如，“用户下单前必须先验证库存”）。

协调多个数据实体的操作（例如，“用户注册成功后，需要同时创建账户记录和发送欢迎邮件”）。

对从DAL获取的数据进行计算、处理和转换。


```

- 简单来说：BLL 关心“数据要做什么”，它调用 DAL 获取或保存数据，并在此基础上实现业务功能

3. Web Controller / Presentation Layer - 表示层

- 全称：表示层，在 Web 应用中通常体现为 Controller（控制器）。

- 职责：负责处理用户交互（接收请求，返回响应）。它是应用程序对外的接口。

- 主要工作：

```
接收来自用户（浏览器、移动App、API客户端）的HTTP请求。

对输入数据进行基本验证（如格式、必填项，而非业务规则）。

调用一个或多个BLL服务来完成请求的业务逻辑。

将BLL返回的结果组装成合适的格式（HTML页面、JSON、XML）并返回给用户。
```

- 简单来说：Controller 是“接待员”，它接收客户（用户）的请求，然后交给后端的“经理”（BLL）去处理，最后把结果回复给客户。

4. Entity - 实体

- 含义：代表业务领域中核心数据对象的类。它们通常是持久化到数据库中的对象。

- 在不同层中的形态：

```
在DAL中，Entity通常直接对应数据库中的表。例如，一个 UserEntity 类对应 Users 表。

在BLL中，它可能被称为“业务模型”或“领域模型”，包含了数据和一部分行为（方法）。例如，User 类可能有一个 ChangePassword 方法。

在早期或简单的三层架构中，Entity可能是一个“贫血模型”，即只有属性（get/set），没有方法，所有逻辑都在BLL中。这正是DDD要改进的地方。
```

# 它们如何协同工作：一个用户注册的例子

假设有一个用户注册的功能：

1. 表示层 （Web Controller）:

```
接收用户提交的注册表单（用户名、密码、邮箱）。

检查数据格式（如邮箱格式是否正确）。

创建一个 UserRegisterDto（数据传输对象）并调用 BLL 的 UserService.Register() 方法。
```

2. 业务逻辑层 （BLL）:

```
UserService 接收到请求。

业务规则验证：调用 DAL 的方法检查用户名和邮箱是否已被注册。

业务逻辑处理：如果验证通过，对密码进行加密，然后创建一个新的 User 实体对象。

调用 DAL 的 UserRepository.Insert() 方法将这个新用户保存到数据库。

可能还会触发其他操作，如将“发送验证邮件”的任务放入消息队列。
```

3. 数据访问层 （DAL）:

```
UserRepository 接收到 User 实体对象。

生成INSERT SQL语句（或通过ORM），打开数据库连接，将用户数据持久化到 Users 表中。

返回操作结果（成功或失败）给BLL。
```
